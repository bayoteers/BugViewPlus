[%#
  # This Source Code Form is subject to the terms of the Mozilla Public
  # License, v. 2.0. If a copy of the MPL was not distributed with this
  # file, You can obtain one at http://mozilla.org/MPL/2.0/.
  #
  # Copyright (C) 2012 Jolla Ltd.
  # Contact: Pami Ketolainen <pami.ketolainen@jollamobile.com>
  #%]

[% IF can_edit_description %]
<pre id="bvp_original_description" style="display: none;">
[% comments.${description}.body %]
</pre>

<script type="text/javascript">

function toggle_comment_edit()
{
    var element = $("#comment_text_[% description %]").first();
    var nodeName = element[0].nodeName;
    if (nodeName == "PRE") {
        $(this).text("cancel")
            .attr("title", "Cancel description changes");
        edit = $("<textarea/>")
            .attr("id", "comment_text_[% description %]")
            .attr("name", "bvp_description")
            .attr("cols", 80)
            .attr("rows", 25)
            .text($("#bvp_original_description").text());
        element.hide()
            .attr("id", "comment_text_[% description %]_orig")
            .before(edit);
    } else if (nodeName == "TEXTAREA") {
        $(this).text("edit")
            .attr("title", "Edit description")
        element.remove();
        $("#comment_text_[% description %]_orig")
            .attr("id", "comment_text_[% description %]")
            .show();
    }
    return false;
}

$(function() {
    // Add edit description link
    $('<a href="#">edit</a>')
        .attr("title", "Edit description")
        .click(toggle_comment_edit)
        .insertBefore("#comment_link_[% description %]")
        .before(" [").after("] ");

    // Add last comment link
    $("ul.bz_collapse_expand_comments").append(
        '<li><a href="#c[% comments.size - 1 %]">To latest comment</a></li>');
});

</script>

[% END %]

